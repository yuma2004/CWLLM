# 運用ガイド

## 目的
本ドキュメントは、リポジトリ構造・命名規則・運用手順・スクリプトの入出力をまとめる。

## 構造
### リポジトリ
- backend/: API・バッチ
- frontend/: UI (React + TypeScript + Vite)
- infra/: Docker Compose・インフラ系スクリプト
- scripts/: 開発/運用補助スクリプト
- Docs/: 仕様・要件・AI分析・運用ドキュメント

### Docs
- Docs/ChatWork_API仕様.md
- Docs/要件定義書.md
- Docs/AI/ (project-map, feature-dependency-map, dependency-clusters)

## 命名規則
- ドキュメント: 内容が分かる名前を付け、空白は使わない。英語名は `kebab-case`。
- スクリプト: 1スクリプト1用途。`kebab-case` で動詞から始める。
- 配置: 運用系は `infra/scripts/`、開発補助は `scripts/`。
- 出力ファイル: 既定の命名はタイムスタンプ付き (`backup_YYYYMMDD_HHmmss.dump`, `CWLLMv_ai_review_YYYYMMDD_HHmmss.zip`)。

## 運用手順
### ローカル起動
1. Docker Compose で DB を起動。
2. backend/frontend を開発モードで起動。

推奨コマンド:
```bash
npm run dev
```

### DB バックアップ/リストア
- Backup:
```powershell
pwsh infra/scripts/backup.ps1 -DatabaseUrl $env:DATABASE_URL -OutputPath backup.dump
```
- Restore:
```powershell
pwsh infra/scripts/restore.ps1 -DatabaseUrl $env:DATABASE_URL -BackupPath backup.dump
```

### AI レビュー用 ZIP
```powershell
pwsh scripts/create-ai-review-zip.ps1 -OutputPath C:\path\to\review.zip
```

## スクリプト入出力
### infra/scripts/backup.ps1
- 入力:
  - `-DatabaseUrl` (未指定時は `DATABASE_URL` を使用)
  - `-OutputPath` (未指定時は `backup_YYYYMMDD_HHmmss.dump`)
- 出力:
  - `pg_dump` 形式の `.dump` ファイル
  - 終了コードは `pg_dump` に準拠

### infra/scripts/restore.ps1
- 入力:
  - `-DatabaseUrl` (未指定時は `DATABASE_URL`)
  - `-BackupPath` (必須)
- 出力:
  - `pg_restore` による復元実行
  - 終了コードは `pg_restore` に準拠

### scripts/create-ai-review-zip.ps1
- 入力:
  - `-OutputPath` (未指定時は `CWLLMv_ai_review_YYYYMMDD_HHmmss.zip`)
  - `-ListOnly` (一覧のみ出力し、zip を生成しない)
- 出力:
  - zip ファイルまたは対象ファイル一覧 (標準出力)
  - `tar` コマンドが必要

### scripts/dev.mjs
- 入力:
  - なし (内部で `docker compose -f infra/docker-compose.yml up -d` と `npm run dev` を実行)
- 出力:
  - backend/frontend のログを標準出力に出力
  - いずれかが終了した場合、両方を終了

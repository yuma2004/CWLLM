# 09 案件 / 卸（Project / Wholesale）

対応要件：
- `FR-PRJ-01..03（Must）` 案件CRUD、広告主企業紐づけ、主要項目
- `FR-WS-01..03（Must）` 卸レコード、条件保持、案件→卸先一覧 / 企業→受け卸一覧
- 画面：`SCR-04 案件一覧/詳細` / `SCR-05 卸一覧/詳細` / `SCR-03 企業詳細`

---

## 完了条件（DoD）

- AI：Project/Wholesale のCRUDが完成（RBAC込み）
- AI：Project詳細に卸一覧が表示される
- AI：Company詳細に「受けた卸一覧」が表示される
- AI：WholesaleがProjectなしで作れない（DB + APIで担保）
- AI：自動テストが通り、`git push` 済み

---

## API一覧（案 / AIが確定）

Project：
- `GET /projects`（検索/ページング）
- `POST /projects`
- `GET /projects/:id`
- `PATCH /projects/:id`
- `DELETE /projects/:id`
- `GET /projects/:id/wholesales`

Wholesale：
- `GET /wholesales`（検索/ページング）
- `POST /wholesales`
- `GET /wholesales/:id`
- `PATCH /wholesales/:id`
- `DELETE /wholesales/:id`

Company側参照：
- `GET /companies/:id/projects`（広告主としての案件）
- `GET /companies/:id/wholesales`（卸先として受けた卸）

---

## TODO（TDD）

### 1) Backend：Project CRUD（AI）

- [ ] 作成：必須 `companyId`（広告主企業）、`name`
- [ ] 主要項目：`conditions`（自由記述）+ `unitPrice`（数値）+ 期間 + status + ownerId
- [ ] 一覧：`q`（案件名）、`companyId`、`status`、ページング
- [ ] RBAC：readはログイン必須、writeは `requireWriteAccess()`

### 2) Backend：Wholesale CRUD（AI）

- [ ] 作成：必須 `projectId` + `companyId`（卸先企業）
- [ ] 主要項目：`conditions` + `unitPrice` + `margin` + `status` + `agreedDate` + `ownerId`
- [ ] 一覧：`projectId`/`companyId`/`status` で検索
- [ ] DB/ API：projectが存在しない場合は400/404で拒否

### 3) Backend：相互参照API（AI）

- [ ] `GET /projects/:id/wholesales`
- [ ] `GET /companies/:id/wholesales`（受けた卸）
- [ ] `GET /companies/:id/projects`（広告主としての案件）

### 4) Backend tests（AI）

- [ ] 案件作成→卸作成→案件詳細に卸一覧が出る
- [ ] 企業詳細に「受けた卸一覧」が出る
- [ ] Wholesaleはproject必須（不正入力で失敗）
- [ ] readonly は作成/更新/削除できない（403）

### 5) Frontend：案件（AI）

- [ ] 案件一覧（検索/フィルタ）
- [ ] 案件詳細（案件情報 + 卸一覧 + 関連タスク枠）
- [ ] 案件作成/編集フォーム（最小）

### 6) Frontend：卸（AI）

- [ ] 卸一覧/詳細
- [ ] 案件詳細から卸を追加できる（UX優先。別画面作成でも可）

### 7) Frontend：企業詳細への統合（AI）

- [ ] 企業詳細に「紐づく案件（広告主）」「受けた卸（卸先）」を表示

### 8) AI検証（AIが実行）

- [ ] `cd backend; npm run test; npm run lint; npm run build`
- [ ] `cd frontend; npm run test; npm run lint; npm run build`
- [ ] スモーク：案件→卸を作成し、相互参照できる

### 9) 人間作業（必須のみ）

- [ ] なし

### 10) Git（AI）

- [ ] `git add -A`
- [ ] `git commit -m \"feat: projects and wholesales\"`
- [ ] `git push`


# 07 タスク管理（Task：企業/案件/卸に紐づけ）

対応要件：
- `FR-TSK-01..03（Must）` タスク作成、担当/期限/優先度/ステータス、マイタスク
- `FR-TSK-04（Should）` 期限通知（後回し可）
- 画面：`SCR-06 タスク管理` / `SCR-03 企業詳細`

---

## 完了条件（DoD）

- AI：Task CRUD が完成し、target（company/project/wholesale）に紐づけられる
- AI：マイタスク（自分の担当）でフィルタ/更新ができる
- AI：readonly が作成/更新できない（403）
- AI：`backend`/`frontend` の自動テストが通り、`git push` 済み

---

## API一覧（案 / AIが確定）

- `GET /tasks`（横断：フィルタ）
- `POST /tasks`（作成）
- `GET /tasks/:id`
- `PATCH /tasks/:id`（更新：status/dueDate/assigneeId 等）
- `DELETE /tasks/:id`
- `GET /me/tasks`（マイタスク：assigneeId=自分）
- `GET /companies/:id/tasks`（企業に紐づくタスク）
- `GET /projects/:id/tasks` / `GET /wholesales/:id/tasks`（後工程で追加）

---

## TODO（TDD）

### 1) Backend：仕様確定（AI）

- [ ] `Task.status` の値を固定（例：`todo`/`in_progress`/`done`/`cancelled`）
- [ ] `targetType` の値を固定（`company`/`project`/`wholesale`）
- [ ] 期限（dueDate）のタイムゾーン方針を決める（MVP：UTC保存、表示はローカル）

### 2) Backend：Task CRUD（AI）

- [ ] `POST /tasks`
  - [ ] 必須：targetType/targetId/title
  - [ ] 任意：description/dueDate/assigneeId/status
- [ ] `GET /tasks`：フィルタ（status/dueDate範囲/assigneeId/targetType/targetId）
- [ ] `PATCH /tasks/:id`：部分更新（status更新は頻出なのでテストを厚め）
- [ ] RBAC：readはログイン必須、writeは `requireWriteAccess()`

### 3) Backend：マイタスク（AI）

- [ ] `GET /me/tasks`（assigneeId=自分）
- [ ] プリセット（期限超過/今日/今週）をAPIで持つかUIで持つか決める（MVPはUIでOK）

### 4) Backend tests（AI）

- [ ] Task作成→企業詳細のタスク一覧に出る
- [ ] マイタスクに自分のタスクだけ出る
- [ ] ステータス更新が反映される
- [ ] readonly は作成/更新/削除できない（403）

### 5) Frontend：マイタスク（AI）

- [ ] 一覧（title/期限/status/対象リンク）
- [ ] フィルタ（status/期限）
- [ ] ステータス更新（ドロップダウン等）

### 6) Frontend：企業詳細タスク（AI）

- [ ] 企業詳細にタスク一覧を表示
- [ ] 追加フォーム（title/期限/担当/メモ）

### 7) Frontend tests（AI）

- [ ] マイタスクが描画される（モック）
- [ ] ステータス更新UIの最小テスト

### 8) AI検証（AIが実行）

- [ ] `cd backend; npm run test; npm run lint; npm run build`
- [ ] `cd frontend; npm run test; npm run lint; npm run build`
- [ ] スモーク：Task作成→マイタスクに出る

### 9) 人間作業（必須のみ）

- [ ] なし

### 10) Git（AI）

- [ ] `git add -A`
- [ ] `git commit -m "feat: task management"`
- [ ] `git push`


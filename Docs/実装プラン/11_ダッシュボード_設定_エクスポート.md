# 11 ダッシュボード / 設定 / エクスポート

対応要件：
- `SCR-01` ダッシュボード
- `FR-DSH-01..02（Should）` 最新要約/未完了タスク/要注意フラグ、案件俯瞰
- `SCR-07` 設定（タグ/ステータス/区分、権限、取り込み対象、要約設定）
- `FR-IO-01（Should）` CSVエクスポート

---

## 完了条件（DoD）

- AI：ダッシュボードAPIが必要データを返し、UIに表示できる
- AI：設定（少なくとも「要約デフォルト期間」「タグ候補」）を保存/参照できる
- AI：CSVエクスポートがダウンロードでき、内容が壊れない（ヘッダ/文字化け/改行）
- AI：自動テストが通り、`git push` 済み

---

## TODO（TDD）

### 1) Backend：ダッシュボード集計（AI）

- [x] `GET /dashboard`（仮）を定義
- [x] 返す項目（MVP案）
  - [x] 期限超過タスク（上位N件）
  - [x] 直近生成された要約（上位N件）
  - [x] 最近更新された企業（上位N件）
- [ ] 集計のクエリを安定させる（件数増でも遅くなりにくい形にする）

### 2) Backend：設定値（AI）

- [x] 設定の保存先を決める
  - [x] MVP案：`AppSetting` テーブル（key/value JSON）
  - [ ] 代替：環境変数（ただしUIから変更不可）
- [x] 設定項目（MVP案）
  - [x] 要約デフォルト期間（例：7日/30日）
  - [x] タグ候補（会社運用のリスト）
  - [ ] 企業ステータス候補/区分候補（必要なら）
- [x] RBAC：設定は admin のみ

### 3) Backend：CSVエクスポート（AI）

- [x] `GET /export/companies.csv`（仮）
- [x] `GET /export/tasks.csv`（仮）
- [x] 文字コード（UTF-8 BOM 付けるか）を決める（Excel想定ならBOM推奨）
- [ ] 大きいデータの扱い（MVPは全件でも可、将来は期間/フィルタ/ストリーミング）

### 4) Backend tests（AI）

- [x] ダッシュボードAPIが必要なキーを返す
- [x] 設定の保存→取得ができる
- [x] CSVが生成され、ヘッダ/行数が期待通り（最小）

### 5) Frontend：ダッシュボード（AI）

- [x] カード表示（期限タスク/最新要約/最近更新企業）
- [x] 企業詳細へのリンク

### 6) Frontend：設定（管理者）（AI）

- [x] 要約デフォルト期間の設定UI
- [x] タグ候補の編集UI（最小：テキストで改行区切りでも可）
- [x] RBAC：admin以外は見えない

### 7) Frontend：エクスポート（AI）

- [x] CSVダウンロードボタン（Companies/Tasks）
- [x] ダウンロード中/失敗の表示

### 8) AI検証（AIが実行）

- [x] `cd backend; npm run test; npm run lint; npm run build`
- [x] `cd frontend; npm run test; npm run lint; npm run build`
- [ ] CSVをダウンロードし、ヘッダと文字化けがないことを確認（自動テスト＋手元確認）

### 9) 人間作業（必須のみ）

- [ ] タグ候補/企業ステータス候補など「運用で使う値」を確定（後から変更可能）

### 10) Git（AI）

- [x] `git add -A`
- [x] `git commit -m \"feat: dashboard settings and export\"`
- [ ] `git push`

# ASP業務管理アプリ 実装タスクプラン

作成日: 2026-02-25  
前提: `ASP_REQUIREMENTS_GAP.md` で整理した差分を解消するための実装計画

## 1. 実装方針

- 既存機能（企業/案件/卸、タスク、Chatwork同期）は活かす
- ただし中核は「Deal中心」に再編する
- ビッグバン置換は避け、段階的に移行する
- まず P0 を先に完成させ、運用に効く価値を最短で出す

## 2. フェーズ構成

| フェーズ | 目的 | 優先度 | 目安 |
| --- | --- | --- | --- |
| Phase 0 | 仕様確定と移行設計 | P0 | 2〜3日 |
| Phase 1 | データモデル拡張（Deal/履歴/Note） | P0 | 1.5〜2週間 |
| Phase 2 | バックエンドAPI実装 | P0 | 1.5〜2週間 |
| Phase 3 | フロント実装（Dashboard/Deal画面） | P0 | 1.5〜2週間 |
| Phase 4 | 自動化・通知・運用強化 | P1 | 1週間 |
| Phase 5 | 非機能/品質保証/移行完了 | P1-P2 | 1週間 |

## 3. 具体タスク（優先度順）

### Phase 0: 仕様固定（先に決める）

1. ステータス遷移を確定する  
   打診前 / 打診中 / 交渉中 / 合意 / 掲載準備中 / 掲載中 / 停止・終了 / 見送り。
2. 用語マッピングを確定する  
   `Wholesale` を段階的に `Deal` として扱う移行方針を決める。
3. 既存データ移行ルールを確定する  
   既存 `unitPrice` の移行先、既存 `status` の変換規則を定義する。

### Phase 1: データモデル拡張（P0）

1. 取引先ロールの複数管理を追加  
   企業に `advertiser/media/asp/other` を複数保持できるようにする。
2. Program情報を拡張  
   成果地点、承認条件、素材LP URL、基本単価、運用ステータスを保持する。
3. Deal情報を拡張  
   提示単価、合意単価、特別条件、担当、次アクション日を保持する。
4. 交渉履歴テーブルを新設  
   「誰が/いつ/いくらを提示・合意したか」を時系列で保持する。
5. Noteテーブルを新設  
   Deal / Program / Partner への紐付け、種別（交渉/依頼/報告/確認/その他）を保持する。

### Phase 2: バックエンドAPI（P0）

1. Deal API（一覧/詳細/作成/更新/削除）を実装  
   ステータス遷移バリデーションを組み込み、無効遷移を拒否する。
2. DealフィルタAPIを実装  
   広告主別、メディア別、ステータス別、担当者別、単価帯別をサポートする。
3. 交渉履歴APIを実装  
   履歴追加と時系列取得を提供する。
4. Note APIを実装  
   Note作成/取得/更新/削除、NoteからTask生成を提供する。
5. ダッシュボードAPI v2を実装  
   自分担当ディール、今日/今週タスク、返答待ち超過を返す。

### Phase 3: フロント実装（P0）

1. Deal一覧画面を新設  
   リスト/カンバン切替、横串フィルタを実装する。
2. Deal詳細画面を新設  
   基本情報、交渉履歴、関連タスク、関連Noteを一画面で扱えるようにする。
3. ダッシュボードを再設計  
   「今対応すべきこと」の優先表示を行う。
4. 取引先/Program画面を拡張  
   関連Dealの横断表示、ロール表示を追加する。

### Phase 4: 自動化・通知（P1）

1. タスク自動生成ルールを実装  
   打診中から一定日数でフォローアップ、合意時に掲載準備チェックリスト作成。
2. 通知アラートを実装  
   期限リマインド、返答待ち超過、ステータス変更通知を提供する。
3. Chatwork通知連携の土台を追加  
   将来のSlack連携も見据えて通知チャネルを抽象化する。

### Phase 5: 品質・運用（P1-P2）

1. 移行スクリプトとロールバック手順を整備
2. 性能計測を追加（主要画面1秒以内の継続確認）
3. 日次バックアップの定期実行設定と監視を整備
4. E2Eテストを追加（ディール作成→交渉→合意→タスク生成）

## 4. 依存関係（重要）

- Phase 1 完了前に Phase 3 の本実装は進めない
- 交渉履歴と Note は Deal API と同時に設計する
- 通知はダッシュボードの優先表示仕様と整合を取る

## 5. MVP定義（最小リリース）

以下が揃えば、要件の中核課題に対して実運用価値が出る:

1. Deal管理（業務ステータス遷移付き）
2. 単価交渉履歴の記録・閲覧
3. Noteの案件紐付けとタスク化
4. 「今やるべきこと」が分かるダッシュボード

## 6. 完了条件（Done）

- チェックリスト9項目で `○` が7項目以上
- `対象外` 項目を除き、`×` 項目を0にする
- 主要運用フロー（打診→交渉→合意→掲載準備）をE2Eで再現できる

## 7. 最初の着手順（今日から進める順）

1. Phase 0 の仕様固定（ステータス遷移・移行ルール）
2. Phase 1 のDB拡張（Deal履歴・Note）
3. Phase 2 の Deal API と交渉履歴API
4. Phase 3 の Deal一覧/詳細とダッシュボード再構成

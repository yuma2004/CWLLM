# 改善実地記録

更新日: 2026-01-06  
凡例: [DONE] 完了 / [PARTIAL] 一部対応 / [TODO] 未実施

---

## 1. 明確な不具合/ミスマッチ
- [DONE] 1) 卸ページ未実装で404になる導線の修正（一覧/詳細/ルート/ナビ）
- [DONE] 2) /me/tasks の targetType/targetId フィルタが効かない問題の修正
- [DONE] 3) 企業一覧100件制限（pageSize=1000問題）の解消（typeahead + 上限調整）
- [DONE] 4) CompanyDetail の admin 専用API誤呼び出しを是正
- [DONE] 5) 文字化け/BOM/不正文字の除去 + .editorconfig 追加

---

## 2. フロントエンド改善

### A. ナビゲーション/IA
- [DONE] 1) 卸管理メニュー追加（一覧＋詳細）
- [DONE] 2) Layout のナビ定義外部化
- [DONE] 3) 画面上部のグローバル検索
- [TODO] 4) 企業/案件詳細のパンくず
- [DONE] 5) サイドバー開閉状態の localStorage 保存

### B. UIコンポーネント統一
- [PARTIAL] 6) Button/Input/Select/Badge/Card/Tabs/Modal/Toast の共通化（主要のみ完了）
- [DONE] 7) StatusBadge で project/wholesale を含めた統一表示
- [DONE] 8) ErrorAlert の role/フォーカス改善
- [DONE] 9) confirm/alert の廃止（ConfirmDialog 統一）
- [PARTIAL] 10) disabled/ローディング表現の統一（主要のみ）

### C. ページ別UX
#### ダッシュボード（Home）
- [DONE] 11) 期限切れ/本日/3日以内/7日以内での分離
- [PARTIAL] 12) 重要メタ表示の拡充（タスクの状態/担当は追加、他は未着手）
- [DONE] 13) 未割当メッセージのCTA追加
- [DONE] 14) 卸導線の404修正

#### タスク（Tasks）
- [DONE] 15) 対象フィルタが機能するよう修正
- [DONE] 16) 対象名表示（target.name）
- [PARTIAL] 17) ステータス即時反映（更新は可能だが optimistic/rollback なし）
- [DONE] 18) dueDate/assignee の一括編集
- [DONE] 19) Kanban 表示
- [DONE] 20) フィルタ状態のURL同期
- [DONE] 21) “自分/全タスク”切替

#### 企業詳細（CompanyDetail）
- [DONE] 22) タブ化
- [DONE] 23) タグ入力のチップ化＋候補表示
- [DONE] 24) copyToClipboard のトースト表示
- [DONE] 25) ラベル絞り込み＋候補
- [DONE] 26) 検索語ハイライト
- [DONE] 27) メッセージのページング
- [DONE] 28) Chatwork ルーム候補は admin のみ
- [PARTIAL] 29) ルーム追加UX（選択式だが検索UIは未実装）
- [DONE] 30) 担当者の編集/削除/並び替え/重複検知
- [DONE] 31) 監査ログに email 表示

#### メッセージ検索/未割当
- [DONE] 32) 企業タイプアヘッド化
- [DONE] 33) 検索結果のページング/総件数
- [DONE] 34) 未割当の一括割当
- [DONE] 35) ラベルの一括付与/解除
- [PARTIAL] 36) 割当後の再検索UX（再検索は実装済、進捗UIは軽め）
- [PARTIAL] 37) 期間プリセットと手入力の整理

#### 案件（Projects / ProjectDetail）
- [DONE] 38) companyId手入力 → 企業検索/選択
- [PARTIAL] 39) 一覧のページング（並び替えは未対応）
- [DONE] 40) 卸詳細へのリンク/統合
- [DONE] 41) 卸情報の編集（モーダルはあるが行内編集ではない）
- [PARTIAL] 42) 保存後のトースト＆差分表示

#### 設定/エクスポート/Chatwork
- [DONE] 43) Settings/Exports/Audit Logs の日本語化
- [DONE] 44) エクスポートの期間/フィルタ対応
- [PARTIAL] 45) 同期の進捗表示（完了メッセージのみ）

### D. 保守性改善
- [PARTIAL] 46) API呼び出し統一（Exports のblob取得など一部残り）
- [PARTIAL] 47) エラーハンドリングの統一
- [TODO] 48) 型定義の重複排除（src/types への統合）
- [DONE] 49) pageSize=1000 の撤去
- [PARTIAL] 50) .editorconfig 追加（CI検知は未対応）
- [TODO] 51) ページ肥大化の分割
- [PARTIAL] 52) 状態管理の粒度整理
- [DONE] 53) 権限判定の共通化（usePermissions）

### E. パフォーマンス
- [TODO] 54) キャッシュ戦略
- [TODO] 55) 仮想スクロール
- [TODO] 56) 画面遷移単位の lazy import
- [PARTIAL] 57) AbortController（typeahead など限定的）

### F. アクセシビリティ/入力体験
- [PARTIAL] 58) フォーカスリング/キーボード操作（ErrorAlert など一部のみ）
- [TODO] 59) 日付ローカライズ/相対時刻
- [PARTIAL] 60) エラー表示のフォーム直下統一

---

## 3. バックエンド改善

### A. API一貫性
- [TODO] 1) エラー形式の統一
- [PARTIAL] 2) ページング形式の統一（主要APIのみ）
- [DONE] 3) /me/tasks のクエリ互換
- [DONE] 4) タスクの target 情報付与
- [DONE] 5) 企業検索API（/companies/search）追加

### B. バリデーション/型安全
- [TODO] 6) スキーマ化（Zod/JSON Schema）
- [TODO] 7) enum化（Role/Status/TargetType）
- [TODO] 8) companies/options のキャッシュ/別テーブル化

### C. DB/クエリ性能
- [TODO] 9) Task(dueDate,status) などの複合index
- [TODO] 10) Project/Wholesale のindex追加
- [TODO] 11) メッセージ全文検索（GIN）
- [TODO] 12) companies/options の高速化

### D. Chatwork同期
- [DONE] 13) ジョブキュー化
- [TODO] 14) 同期排他/履歴
- [TODO] 15) 部分失敗の可視化

### E. LLM要約
- [DONE] 16) truncate の不正文字修正 + 単体テスト
- [TODO] 17) 分割要約/入力制限戦略
- [DONE] 18) 非同期ジョブ化/キャンセル
- [DONE] 19) メタ情報保存
- [TODO] 20) 日本語プロンプト改善

### F. 監査ログ
- [TODO] 21) AuditLog.changes の JSON 化
- [TODO] 22) 監査対象の拡大

### G. セキュリティ/設定
- [DONE] 23) JWT_SECRET 未設定時の起動失敗
- [DONE] 24) CORS allowlist 化
- [TODO] 25) ログインレートリミット
- [TODO] 26) パスワードポリシー
- [DONE] 27) trustProxy 設定

### H. 開発体験/ドキュメント
- [DONE] 28) OpenAPI 生成
- [DONE] 29) env 必須チェック

---

## 4. TODO付き実行プラン（進捗）

### フェーズ0（P0中心）
- [DONE] /wholesales 一覧ページ
- [DONE] /wholesales/:id 詳細ページ
- [DONE] /me/tasks の targetType/targetId 対応
- [PARTIAL] Tasks フィルタの自動テスト追加（未実施）
- [DONE] CompanyDetail の admin 制限
- [DONE] /companies/search 追加
- [DONE] MessageSearch/Unassigned/ProjectDetail でタイプアヘッド化
- [DONE] 文字化け/BOM 除去
- [DONE] LLM truncate 修正 + 単体テスト
- [DONE] Settings/Exports/Audit Logs の日本語化

### フェーズ1（P1中心）
- [DONE] APIクライアント統一（apiRequest）
- [PARTIAL] useFetch/useMutation 適用拡大
- [TODO] 型定義の集約
- [DONE] StatusBadge 統一
- [PARTIAL] UIコンポーネントの統一
- [PARTIAL] .editorconfig + CI検知
- [DONE] 権限判定の共通化

### フェーズ2（P1〜P2）
- [DONE] タスク一覧の対象名表示
- [DONE] タスクAPIの target 情報付与
- [DONE] 未割当メッセージのページング + 一括割当
- [DONE] メッセージラベル候補API
- [DONE] MessageSearch：ハイライト/ラベル/URL同期
- [DONE] 企業タグ入力のチップ化
- [DONE] Projects 作成の企業選択化
- [PARTIAL] 卸一覧のフィルタ/CSV導線（IDフィルタのみ、CSV未対応）
- [DONE] 要約画面の default period / 生成UI / 候補一括作成

### フェーズ3〜5
- [TODO] 記載項目の多くは未着手（API契約強化、非同期ジョブ化、セキュリティ等）
